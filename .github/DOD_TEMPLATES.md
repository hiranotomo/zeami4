# Definition of Done (DOD) Templates

このドキュメントは、プルリクエストの完了条件を変更タイプ別に定義しています。

## Type 1: ワークフロー追加/変更

GitHub Actionsワークフロー（`.github/workflows/`）の追加または修正時に適用されます。

### 完了条件

- [ ] **ドライランテスト成功** - 本番前にテスト環境で検証済み
- [ ] **実環境での動作確認** - 実際のリポジトリで正常に動作確認
- [ ] **エラーケースの検証** - 異常系（エラー時のリトライ、タイムアウト等）を検証
- [ ] **ログ出力の確認** - 適切なログが出力され、デバッグ時に有用か確認
- [ ] **トリガー条件の検証** - 意図した条件で動作確認（ブランチ、イベント等）
- [ ] **依存ステップの確認** - ステップ間の依存関係が正しく設定されている
- [ ] **シークレット/環境変数の設定確認** - 必要な設定がリポジトリに適用されている

### チェックリスト例

```markdown
### ワークフロー: XXX

ドライラン：
- [ ] Event トリガーを確認
- [ ] ステップの動作を確認
- [ ] ログを確認

本番環境での動作確認：
- [ ] 実際のリポジトリで正常に動作
- [ ] 期待される結果を確認

エラーケース検証：
- [ ] リトライロジックの確認
- [ ] タイムアウト時の動作確認
- [ ] 権限不足時の動作確認
```

---

## Type 2: Agent追加/変更

`.claude/agents/` または `.claude/commands/` ファイルの追加・修正時に適用されます。

### 完了条件

- [ ] **Agent定義の構文確認** - YAML/Markdown形式が正しい
- [ ] **使用ツールの権限確認** - 使用するツール/APIに必要な権限がある
- [ ] **サンプルタスクでの動作確認** - 簡単なテストタスクで動作確認
- [ ] **トークン使用量の測定** - 過度なトークン消費がないか確認
- [ ] **エラーハンドリング** - 予期しない入力に対する対応を確認
- [ ] **ドキュメント整備** - 使用方法が明確に記載されている

### チェックリスト例

```markdown
### Agent: XXX

構文確認：
- [ ] YAML/Markdown形式が正しい
- [ ] 必須フィールドが揃っている

権限確認：
- [ ] 使用するツールが利用可能
- [ ] 必要な権限が設定されている

動作確認：
- [ ] サンプルタスク1で動作確認
- [ ] サンプルタスク2で動作確認
- [ ] トークン使用量を確認

ドキュメント：
- [ ] 使用方法が記載されている
- [ ] 例が提供されている
```

---

## Type 3: ドキュメント

`README.md`、Wiki、`.github/` 内のドキュメントなどの追加・修正時に適用されます。

### 完了条件

- [ ] **リンク切れチェック** - 内部リンク、外部リンクが有効か確認
- [ ] **フォーマット検証** - Markdown形式が正しくレンダリングされるか確認
- [ ] **スペル・文法チェック** - 日本語の場合は表記ゆれがないか確認
- [ ] **最新性の確認** - ドキュメント内の情報が最新か確認
- [ ] **オーナーシップの明確化** - 誰が管理するか明確か確認
- [ ] **Wiki移行対応**（該当する場合） - Wiki表示確認、リンク更新

### チェックリスト例

```markdown
### ドキュメント: XXX

リンク確認：
- [ ] 内部リンクが有効
- [ ] 外部リンクが有効
- [ ] アンカーリンクが有効

フォーマット確認：
- [ ] Markdownが正しくレンダリング
- [ ] コードブロックが正しく表示
- [ ] テーブルが正しく表示

内容確認：
- [ ] 情報が最新
- [ ] 表記ゆれがない
- [ ] 図表が分かりやすい
```

---

## Type 4: コード変更

JavaScriptやTypeScript等のコードロジック変更時に適用されます。

### 完了条件

- [ ] **ユニットテスト追加/更新** - 新機能にはテストを追加、修正されたコードのテストを更新
- [ ] **既存テストのパス** - 既存テストがすべてパス
- [ ] **リント/フォーマット確認** - `npm run lint` が成功
- [ ] **統合テスト**（該当する場合） - エンドツーエンドテストが成功
- [ ] **パフォーマンス確認**（必要に応じて） - 性能に悪影響がないか確認
- [ ] **コードレビュー対応** - レビューコメントに対応

### チェックリスト例

```markdown
### コード: XXX

テスト：
- [ ] ユニットテストを追加/更新
- [ ] テストカバレッジを確認
- [ ] `npm test` がパス

品質確認：
- [ ] `npm run lint` がパス
- [ ] 既存テストが全てパス
- [ ] 型チェック（TS）がパス

パフォーマンス：
- [ ] メモリリークがない
- [ ] パフォーマンス劣化がない
```

---

## 共通項目（すべての変更に適用）

### PR共通の確認事項

- [ ] **コミットメッセージが適切** - `{type}: #{issue-number} {description}` 形式に従っている
- [ ] **ブランチ名が適切** - `{type}/{issue-number}-{description}` 形式に従っている
- [ ] **AI開発ガイドラインへの準拠** - 該当するガイドラインを確認している
- [ ] **Related Issueが明記** - PR説明で対応するIssueを明記（`Closes #XXX`）
- [ ] **破壊的変更の説明** - 破壊的変更がある場合はマイグレーションガイドを記載

---

## 使用方法

1. PRを作成する際、変更タイプを特定します
2. 対応するDODテンプレートを確認します
3. PR説明欄に該当するチェックリストをコピー&ペーストします
4. すべての項目をチェックしてからマージします

---

## 変更タイプの判断フローチャート

```
変更内容の確認
  │
  ├─ .github/workflows/ の変更？ → Type 1: ワークフロー
  │
  ├─ .claude/agents/ または .claude/commands/ の変更？ → Type 2: Agent
  │
  ├─ README.md、Wiki、ドキュメント変更？ → Type 3: ドキュメント
  │
  └─ コードロジック（src/, lib/ 等）の変更？ → Type 4: コード
```

複数のタイプに該当する場合は、すべてのDODを適用してください。
